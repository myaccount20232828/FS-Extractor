name: iOS FS Extractor
on:
  push:
jobs:
  Extract:
    name: iOS FS Extractor
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - name: Download IPSW
        run: curl "https://secure-appldnld.apple.com/iPhone/061-3538.20070629.B7vXa/iPhone1,1_1.0_1A543a_Restore.ipsw" -o IPSW.ipsw
      - name: Extract IPSW
        run: unzip *.ipsw -d ExtractedIPSW
      - name: Mount DMG
        run: |
             python Decrypt_RootFS.py ExtractedIPSW/$(/usr/libexec/PlistBuddy -c "print BuildIdentities:0:Manifest:OS:Info:Path" ExtractedIPSW/BuildManifest.plist)
             hdiutil attach -mountpoint FS RootFS.dmg
        run: rm *.ipsw && rm -rf ExtractedIPSW
      - name: Make Zip
        run: |
              mkdir Stuff
              cp -r FS/
              zip -r9 "RootFS.zip" Stuff
      - name: Upload 
        uses: actions/upload-artifact@v3
        with:
          name: File.zip
          path: "*.zip"
